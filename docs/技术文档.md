# 学生在线学习系统 - 技术文档

## 目录

- [1. 项目概述](#1-项目概述)
- [2. 技术架构](#2-技术架构)
- [3. 技术栈](#3-技术栈)
- [4. 项目结构](#4-项目结构)
- [5. 核心模块](#5-核心模块)
- [6. 数据流设计](#6-数据流设计)
- [7. API 接口文档](#7-api-接口文档)
- [8. 路由设计](#8-路由设计)
- [9. 状态管理](#9-状态管理)
- [10. 权限控制](#10-权限控制)
- [11. 开发规范](#11-开发规范)
- [12. 部署说明](#12-部署说明)

---

## 1. 项目概述

### 1.1 项目简介

学生在线学习系统是一个现代化的在线教育平台前端应用，采用 Vue 3 + Vite 构建，提供了完整的在线学习、练习、考试功能，支持多角色管理，为学生提供智能化的学习体验。

### 1.2 核心功能

#### 学生端功能
- **用户认证**：注册、登录、邮箱验证、密码重置
- **课程学习**：浏览课程列表、查看章节内容
- **练习模式**：章节刷题、实时答题反馈、答案解析
- **考试模式**：限时考试、答题卡功能、成绩统计
- **错题本**：错题收集、错题练习、移除错题
- **个人中心**：个人信息管理、考试记录、练习记录

#### 管理端功能
- **数据统计**：用户、课程、题目、考试数据可视化
- **用户管理**：用户CRUD、角色分配、密码重置
- **角色管理**：角色CRUD、权限分配
- **课程管理**：课程CRUD、章节管理
- **题目管理**：题目CRUD、Excel批量导入
- **考试追踪**：考试记录查询、成绩分析

### 1.3 技术特点

- ✅ Vue 3 Composition API
- ✅ Vite 快速开发构建
- ✅ Pinia 状态管理
- ✅ Element Plus UI 组件库
- ✅ 动态路由 + 权限控制
- ✅ Axios 请求封装
- ✅ 响应式设计（支持移动端）
- ✅ ECharts 数据可视化
- ✅ Excel 文件解析与导入

---

## 2. 技术架构

### 2.1 系统架构图

```
┌─────────────────────────────────────────────────────┐
│                    浏览器客户端                        │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────┐
│                  Vue 3 应用层                         │
│  ┌──────────────┬──────────────┬──────────────┐    │
│  │  视图层(Views) │ 组件层(Components) │ 布局层(Layouts) │  │
│  └──────────────┴──────────────┴──────────────┘    │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────┐
│                  逻辑层                                │
│  ┌──────────────┬──────────────┬──────────────┐    │
│  │  路由管理     │   状态管理     │   工具函数    │    │
│  │  (Router)    │   (Pinia)     │   (Utils)    │    │
│  └──────────────┴──────────────┴──────────────┘    │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────┐
│                  数据层                                │
│  ┌──────────────────────────────────────────────┐  │
│  │           API 接口层 (Axios)                   │  │
│  └──────────────────────────────────────────────┘  │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────┐
│              后端 API 服务 (https://api.pnrp.cn)      │
└─────────────────────────────────────────────────────┘
```

### 2.2 应用分层

#### 视图层 (Views)
- 负责页面展示和用户交互
- 调用 API 接口获取数据
- 使用状态管理同步数据

#### 组件层 (Components)
- 可复用的 UI 组件
- 通用业务组件
- 布局组件

#### 逻辑层
- **路由管理**：页面导航、路由守卫、权限验证
- **状态管理**：全局状态、用户信息、菜单数据
- **工具函数**：通用工具、请求封装、数据处理

#### 数据层
- API 接口封装
- 请求拦截器
- 响应拦截器
- 错误处理

---

## 3. 技术栈

### 3.1 核心框架

| 技术 | 版本 | 说明 |
|------|------|------|
| Vue | ^3.5.25 | 渐进式 JavaScript 框架 |
| Vite | ^7.2.4 | 下一代前端构建工具 |
| Vue Router | ^4.6.3 | Vue.js 官方路由管理器 |
| Pinia | ^3.0.4 | Vue 状态管理库 |

### 3.2 UI 框架

| 技术 | 版本 | 说明 |
|------|------|------|
| Element Plus | ^2.11.9 | Vue 3 组件库 |
| @element-plus/icons-vue | ^2.3.2 | Element Plus 图标库 |

### 3.3 工具库

| 技术 | 版本 | 说明 |
|------|------|------|
| Axios | ^1.13.2 | HTTP 请求库 |
| ECharts | ^6.0.0 | 数据可视化图表库 |
| XLSX | ^0.18.5 | Excel 文件解析库 |
| Crypto-JS | ^4.2.0 | 加密库 |
| Day.js | ^1.11.19 | 日期处理库 |
| @vueuse/core | ^14.1.0 | Vue 组合式工具集 |

### 3.4 开发工具

| 技术 | 版本 | 说明 |
|------|------|------|
| @vitejs/plugin-vue | ^6.0.2 | Vite Vue 插件 |
| vite-plugin-vue-devtools | ^8.0.5 | Vue 开发者工具 |
| Sass | ^1.94.2 | CSS 预处理器 |

---

## 4. 项目结构

```
findrillPage/
├── public/                      # 静态资源
├── src/
│   ├── api/                     # API 接口
│   │   ├── admin.js            # 管理端接口
│   │   ├── auth.js             # 认证接口
│   │   ├── chapter.js          # 章节接口
│   │   ├── course.js           # 课程接口
│   │   ├── exam.js             # 考试接口
│   │   ├── practice.js         # 练习接口
│   │   ├── user.js             # 用户接口
│   │   └── wrong.js            # 错题接口
│   │
│   ├── assets/                  # 资源文件
│   │   ├── styles/             # 样式文件
│   │   │   ├── common.scss     # 公共样式
│   │   │   └── variables.scss  # SCSS 变量
│   │   ├── base.css            # 基础样式
│   │   ├── main.css            # 主样式
│   │   └── images/             # 图片资源
│   │
│   ├── components/              # 组件
│   │   ├── layout/             # 布局组件
│   │   │   └── AdminLayout.vue # 管理后台布局
│   │   ├── common/             # 通用组件
│   │   │   └── RouteLoading.vue
│   │   ├── question/           # 题目组件
│   │   ├── upload/             # 上传组件
│   │   ├── AnswerCard.vue      # 答题卡
│   │   └── BottomNav.vue       # 底部导航
│   │
│   ├── router/                  # 路由
│   │   ├── index.js            # 路由配置
│   │   └── guards.js           # 路由守卫
│   │
│   ├── stores/                  # 状态管理
│   │   ├── auth.js             # 认证状态
│   │   ├── course.js           # 课程状态
│   │   ├── exam.js             # 考试状态
│   │   └── menu.js             # 菜单状态
│   │
│   ├── utils/                   # 工具函数
│   │   ├── request.js          # Axios 封装
│   │   ├── storage.js          # LocalStorage 封装
│   │   ├── excelParser.js      # Excel 解析
│   │   ├── helpers.js          # 辅助函数
│   │   └── routeFilter.js      # 路由过滤
│   │
│   ├── views/                   # 页面视图
│   │   ├── auth/               # 认证页面
│   │   │   ├── Login.vue       # 登录
│   │   │   ├── EmailVerify.vue # 邮箱验证
│   │   │   └── VerifyEmailToken.vue
│   │   ├── course/             # 课程页面
│   │   │   ├── CourseList.vue  # 课程列表
│   │   │   └── ChapterList.vue # 章节列表
│   │   ├── exam/               # 考试页面
│   │   │   ├── ExamMode.vue    # 考试模式
│   │   │   └── ExamResult.vue  # 考试结果
│   │   ├── practice/           # 练习页面
│   │   │   └── PracticeMode.vue
│   │   ├── wrong/              # 错题页面
│   │   │   ├── WrongList.vue   # 错题列表
│   │   │   └── WrongPractice.vue
│   │   ├── profile/            # 个人中心
│   │   │   ├── ProfileView.vue
│   │   │   ├── EditProfile.vue
│   │   │   ├── ExamRecords.vue
│   │   │   └── PracticeRecords.vue
│   │   ├── admin/              # 管理后台
│   │   │   ├── Dashboard.vue   # 数据统计
│   │   │   ├── UserManage.vue  # 用户管理
│   │   │   ├── RoleManage.vue  # 角色管理
│   │   │   ├── CourseManage.vue
│   │   │   ├── ChapterManage.vue
│   │   │   ├── QuestionManage.vue
│   │   │   ├── QuestionUpload.vue
│   │   │   └── TraceManage.vue
│   │   └── NotFound.vue        # 404 页面
│   │
│   ├── App.vue                  # 根组件
│   └── main.js                  # 入口文件
│
├── docs/                        # 文档目录
├── index.html                   # HTML 模板
├── vite.config.js              # Vite 配置
├── jsconfig.json               # JavaScript 配置
├── package.json                # 项目配置
└── README.md                   # 项目说明
```

---

## 5. 核心模块

### 5.1 认证模块

#### 功能描述
用户认证模块负责用户的注册、登录、邮箱验证、密码重置等功能。

#### 核心文件
- `src/api/auth.js` - 认证相关 API
- `src/stores/auth.js` - 认证状态管理
- `src/views/auth/Login.vue` - 登录页面
- `src/views/auth/EmailVerify.vue` - 邮箱验证页面

#### 技术实现

**密码加密**
```javascript
import CryptoJS from 'crypto-js'

digestMessage(message) {
  return CryptoJS.SHA256(message).toString()
}
```

**登录流程**
1. 用户输入用户名和密码
2. 前端使用 SHA256 加密密码
3. 发送加密后的密码到后端
4. 后端验证成功返回用户信息
5. 前端保存用户信息到 LocalStorage 和 Pinia Store
6. 设置 Cookie（由后端通过 Set-Cookie 响应头设置）

**邮箱验证流程**
1. 用户在登录后未验证邮箱，自动跳转到邮箱验证页面
2. 用户输入邮箱地址，点击发送验证链接
3. 后端发送包含 token 的验证链接到用户邮箱
4. 用户点击邮件中的链接，跳转到验证页面
5. 前端从 URL 中提取 token，调用验证接口
6. 验证成功后更新用户状态

### 5.2 路由模块

#### 静态路由
预定义的基础路由，所有用户都可以访问（根据权限限制）。

#### 动态路由
管理后台的路由根据用户权限动态加载。

**动态路由实现**
```javascript
// 1. 用户登录成功后，获取菜单列表
const menuStore = useMenuStore()
await menuStore.loadMenus()

// 2. 根据菜单数据动态添加路由
export function addAdminRoutes(menus) {
  menus.forEach(menu => {
    const route = {
      path: menu.path,
      name: menu.name,
      component: () => import(menu.component),
      meta: menu.meta
    }
    router.addRoute(route)
  })
}
```

#### 路由守卫

**全局前置守卫**
- 设置页面标题
- 登录状态检查
- 邮箱验证检查
- 管理员权限检查
- 动态路由加载

```javascript
router.beforeEach(async (to, from, next) => {
  // 1. 设置页面标题
  document.title = to.meta.title ? `${to.meta.title} - 学生在线学习系统` : '学生在线学习系统'
  
  // 2. 登录检查
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next({ path: '/login', query: { redirect: to.fullPath } })
    return
  }
  
  // 3. 邮箱验证检查
  if (to.meta.requiresEmailVerified && !authStore.isEmailVerified) {
    next('/email-verify')
    return
  }
  
  // 4. 管理员路由检查
  if (to.path.startsWith('/admin/')) {
    if (!menuStore.loaded) {
      await menuStore.loadMenus()
      next({ ...to, replace: true })
      return
    }
    
    const routeExists = router.getRoutes().some(route => route.path === to.path)
    if (!routeExists) {
      ElMessage.error('您没有访问该页面的权限')
      next('/courses')
      return
    }
  }
  
  next()
})
```

### 5.3 状态管理模块

#### Auth Store (认证状态)

**状态**
- `loginFlag` - 登录标志
- `userInfo` - 用户信息

**计算属性**
- `isLoggedIn` - 是否已登录
- `isEmailVerified` - 邮箱是否已验证
- `userRole` - 用户角色

**方法**
- `login()` - 登录
- `logout()` - 退出登录
- `clearAuth()` - 清除认证信息
- `updateUserInfo()` - 更新用户信息
- `setEmailVerified()` - 设置邮箱验证状态

#### Menu Store (菜单状态)

**状态**
- `menuList` - 菜单列表
- `loading` - 加载状态
- `loaded` - 是否已加载

**方法**
- `loadMenus()` - 加载菜单（自动添加动态路由）
- `clearMenus()` - 清空菜单
- `reloadMenus()` - 重新加载菜单

#### Course Store (课程状态)

**状态**
- `courseList` - 课程列表
- `currentCourse` - 当前课程

**方法**
- `setCourseList()` - 设置课程列表
- `setCurrentCourse()` - 设置当前课程

### 5.4 API 请求模块

#### Axios 封装

**配置**
```javascript
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 15000,
  withCredentials: true  // 携带 Cookie
})
```

**响应拦截器**
```javascript
request.interceptors.response.use(
  (response) => {
    const { code, msg, message, data } = response.data
    
    if (code === 200) {
      return data  // 直接返回数据
    }
    
    // 邮箱未验证
    if (code === 403 && message.includes('邮箱未验证')) {
      router.push('/email-verify')
      return Promise.reject(new Error(message))
    }
    
    // 未登录或 token 失效
    if (code === 401) {
      authStore.clearAuth()
      router.push('/login')
      return Promise.reject(new Error(message))
    }
    
    // 其他错误
    ElMessage.error(message || '请求失败')
    return Promise.reject(new Error(message))
  },
  (error) => {
    // 网络错误处理
    if (error.message.includes('timeout')) {
      ElMessage.error('请求超时，请检查网络')
    } else {
      ElMessage.error('网络连接失败')
    }
    return Promise.reject(error)
  }
)
```

### 5.5 练习与考试模块

#### 练习模式特点
- 即时反馈：答题后立即显示正确答案和解析
- 无时间限制：用户可以自由控制答题节奏
- 支持上一题/下一题切换
- 答题卡功能：快速跳转到指定题目
- 自动收集错题

#### 考试模式特点
- 倒计时功能：限时考试
- 答题卡：显示答题进度
- 不显示答案：考试期间不显示正确答案
- 提交后显示成绩和详细分析
- 自动收集错题

#### 答题流程

**练习模式**
```javascript
// 1. 选择选项
const handleSelectOption = (index) => {
  if (currentQuestion.type === 'single' || currentQuestion.type === 'judge') {
    // 单选题或判断题：直接选中并提交
    currentAnswer.value = [index]
    handleSubmit()
  } else {
    // 多选题：可以选择多个选项
    if (currentAnswer.value.includes(index)) {
      currentAnswer.value = currentAnswer.value.filter(i => i !== index)
    } else {
      currentAnswer.value.push(index)
    }
  }
}

// 2. 提交答案
const handleSubmit = async () => {
  // 判断答案是否正确
  const isCorrect = checkAnswer(currentAnswer.value, currentQuestion.correctAnswer)
  
  // 显示答案和解析
  showAnswer.value = true
  
  // 记录答题情况
  userAnswers.value[currentIndex.value] = {
    answer: currentAnswer.value,
    isCorrect: isCorrect
  }
  
  // 如果答错，自动收集到错题本
  if (!isCorrect) {
    await addToWrongBook(currentQuestion.id)
  }
}
```

**考试模式**
```javascript
// 1. 开始考试
const startExam = async () => {
  // 获取试卷
  const paper = await getExamPaper({
    courseId: route.query.curriculumId,
    chapterId: route.query.chapterId,
    count: examQuestionCount
  })
  
  questions.value = paper.questions
  examStarted.value = true
  
  // 开始倒计时
  startCountdown()
}

// 2. 倒计时
const startCountdown = () => {
  timer = setInterval(() => {
    remainingTime.value--
    
    if (remainingTime.value <= 0) {
      clearInterval(timer)
      handleSubmitExam()  // 时间到自动提交
    }
  }, 1000)
}

// 3. 提交试卷
const handleSubmitExam = async () => {
  const examData = {
    courseId: route.query.curriculumId,
    chapterId: route.query.chapterId,
    answers: userAnswers.value,
    duration: examDuration - remainingTime.value
  }
  
  const result = await submitExam(examData)
  
  // 跳转到成绩页面
  router.push({
    name: 'ExamResult',
    params: { id: result.examId }
  })
}
```

### 5.6 错题本模块

#### 功能描述
错题本自动收集用户答错的题目，支持按课程和章节筛选，提供错题练习功能。

#### 技术实现

**错题收集**
```javascript
// 答题时自动收集错题
if (!isCorrect) {
  await submitWrongAnswer({
    subjectId: currentQuestion.id,
    answer: userAnswer,
    isCorrect: false
  })
}
```

**错题练习**
```javascript
// 获取错题列表
const wrongQuestions = await getWrongPracticeQuestions({
  examId: route.params.curriculumId,
  page: 1,
  pageSize: 50
})

// 错题练习流程与普通练习相同
// 答对后可以选择从错题本中移除
```

### 5.7 管理后台模块

#### Dashboard（数据统计）
- 用户总数、课程数量、题目数量、考试次数统计
- 考试情况统计图表（ECharts）
- 用户增长趋势图表（ECharts）
- 最近考试记录列表

**ECharts 图表实现**
```javascript
import * as echarts from 'echarts'

const initChart = () => {
  const chartInstance = echarts.init(chartRef.value)
  
  const option = {
    title: { text: '考试情况统计' },
    tooltip: {},
    xAxis: { data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'] },
    yAxis: {},
    series: [{
      type: 'bar',
      data: [120, 200, 150, 80, 70, 110, 130]
    }]
  }
  
  chartInstance.setOption(option)
}
```

#### 题目管理
- 题目的 CRUD 操作
- Excel 批量导入题目
- 题目筛选和搜索

**Excel 导入实现**
```javascript
import * as XLSX from 'xlsx'

export const parseExcelFile = (file) => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    
    reader.onload = (e) => {
      const data = new Uint8Array(e.target.result)
      const workbook = XLSX.read(data, { type: 'array' })
      const worksheet = workbook.Sheets[workbook.SheetNames[0]]
      const jsonData = XLSX.utils.sheet_to_json(worksheet)
      
      // 转换数据格式
      const questions = jsonData.map(row => formatQuestionData(row))
      
      resolve({ success: true, data: questions })
    }
    
    reader.readAsArrayBuffer(file)
  })
}
```

---

## 7. API 接口文档

### 7.1 认证接口

#### 登录
```
POST /login
Content-Type: application/json

Request:
{
  "userName": "string",
  "password": "string (SHA256 加密)"
}

Response:
{
  "code": 200,
  "data": {
    "id": 1,
    "userName": "string",
    "email": "string",
    "roleName": "string",
    "isActiveEmail": boolean
  }
}
```

#### 发送邮箱验证链接
```
POST /email/send
Content-Type: application/json

Request:
{
  "user": "string",
  "password": "string (SHA256 加密)",
  "email": "string"
}

Response:
{
  "code": 200,
  "msg": "发送成功"
}
```

#### 验证邮箱
```
GET /email/verify?token={token}

Response:
{
  "code": 200,
  "data": true
}
```

#### 退出登录
```
POST /logout

Response:
{
  "code": 200,
  "msg": "退出成功"
}
```

### 7.2 课程接口

#### 获取课程列表
```
GET /courses?page={page}&pageSize={size}&keyword={keyword}

Response:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "string",
      "remarks": "string",
      "questionCount": 100,
      "recentExamCount": 10
    }
  ]
}
```

#### 获取章节列表
```
GET /chapters?courseId={courseId}

Response:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "string",
      "courseId": 1,
      "questionCount": 50
    }
  ]
}
```

### 7.3 练习接口

#### 获取练习题目
```
GET /practice/questions?courseId={courseId}&chapterId={chapterId}&page={page}&size={size}

Response:
{
  "code": 200,
  "data": {
    "questions": [
      {
        "id": 1,
        "subject": "string",
        "type": 1,  // 1-单选 2-多选 3-判断
        "difficulty": 2,  // 1-简单 2-中等 3-困难
        "options": [
          { "text": "选项A" },
          { "text": "选项B" },
          { "text": "选项C" },
          { "text": "选项D" }
        ],
        "correctAnswer": [0],
        "knowledgePoint": "string",
        "analysis": "string"
      }
    ],
    "total": 100
  }
}
```

#### 提交练习记录
```
POST /practice/submit
Content-Type: application/json

Request:
{
  "courseId": 1,
  "chapterId": 1,
  "answers": [
    {
      "questionId": 1,
      "answer": [0],
      "isCorrect": true
    }
  ]
}

Response:
{
  "code": 200,
  "data": {
    "practiceId": 1,
    "correctCount": 80,
    "totalCount": 100
  }
}
```

### 7.4 考试接口

#### 获取考试试卷
```
GET /exam/paper?courseId={courseId}&chapterId={chapterId}&count={count}

Response:
{
  "code": 200,
  "data": {
    "questions": [...],
    "duration": 60  // 分钟
  }
}
```

#### 提交考试
```
POST /exam/submit
Content-Type: application/json

Request:
{
  "courseId": 1,
  "chapterId": 1,
  "answers": [...],
  "duration": 3600  // 秒
}

Response:
{
  "code": 200,
  "data": {
    "examId": 1,
    "score": 85,
    "correctCount": 17,
    "totalCount": 20
  }
}
```

#### 获取考试结果
```
GET /exam/{examId}

Response:
{
  "code": 200,
  "data": {
    "id": 1,
    "score": 85,
    "correctCount": 17,
    "totalCount": 20,
    "questions": [...],
    "userAnswers": [...],
    "createTime": "2025-12-24 10:00:00"
  }
}
```

### 7.5 错题接口

#### 获取错题列表
```
GET /wrong/list?page={page}&pageSize={size}

Response:
{
  "code": 200,
  "data": [
    {
      "curriculumId": 1,
      "curriculumName": "string",
      "wrongCount": 10
    }
  ]
}
```

#### 获取错题练习题目
```
GET /wrong/practice?examId={curriculumId}&page={page}&pageSize={size}

Response:
{
  "code": 200,
  "data": {
    "questions": [...],
    "total": 10
  }
}
```

#### 提交错题答案
```
POST /wrong/check
Content-Type: application/json

Request:
{
  "subjectId": 1,
  "answer": [0],
  "isCorrect": true,
  "examId": 1,
  "sort": 1
}

Response:
{
  "code": 200,
  "msg": "提交成功"
}
```

### 7.6 管理端接口

#### 获取统计数据
```
GET /admin/stats

Response:
{
  "code": 200,
  "data": {
    "userCount": 100,
    "courseCount": 10,
    "questionCount": 1000,
    "examCount": 500
  }
}
```

#### 获取用户列表
```
GET /admin/users?page={page}&size={size}&keyword={keyword}

Response:
{
  "code": 200,
  "data": {
    "list": [...],
    "total": 100
  }
}
```

#### 获取菜单列表
```
GET /menu

Response:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "Dashboard",
      "path": "/admin/dashboard",
      "component": "@/views/admin/Dashboard.vue",
      "meta": {
        "title": "数据统计",
        "icon": "DataAnalysis"
      }
    }
  ]
}
```

---

## 8. 路由设计

### 8.1 前台路由

| 路径 | 组件 | 说明 | 权限 |
|------|------|------|------|
| / | - | 重定向到 /courses | - |
| /login | Login.vue | 登录页面 | 公开 |
| /email-verify | EmailVerify.vue | 邮箱验证 | 公开 |
| /courses | CourseList.vue | 课程列表 | 需要登录 + 邮箱验证 |
| /courses/:id/chapters | ChapterList.vue | 章节列表 | 需要登录 + 邮箱验证 |
| /practice | PracticeMode.vue | 练习模式 | 需要登录 + 邮箱验证 |
| /exam | ExamMode.vue | 考试模式 | 需要登录 + 邮箱验证 |
| /exam/result/:id | ExamResult.vue | 考试结果 | 需要登录 + 邮箱验证 |
| /wrong | WrongList.vue | 错题列表 | 需要登录 + 邮箱验证 |
| /wrong/practice/:id | WrongPractice.vue | 错题练习 | 需要登录 + 邮箱验证 |
| /profile | ProfileView.vue | 个人中心 | 需要登录 + 邮箱验证 |
| /profile/exam-records | ExamRecords.vue | 考试记录 | 需要登录 + 邮箱验证 |
| /profile/practice-records | PracticeRecords.vue | 练习记录 | 需要登录 + 邮箱验证 |
| /profile/edit/:id | EditProfile.vue | 编辑个人信息 | 需要登录 + 邮箱验证 |

### 8.2 后台路由（动态路由）

| 路径 | 组件 | 说明 | 权限 |
|------|------|------|------|
| /admin/dashboard | Dashboard.vue | 数据统计 | 管理员 |
| /admin/users | UserManage.vue | 用户管理 | 管理员 |
| /admin/roles | RoleManage.vue | 角色管理 | 超级管理员 |
| /admin/courses | CourseManage.vue | 课程管理 | 管理员 |
| /admin/chapters | ChapterManage.vue | 章节管理 | 管理员 |
| /admin/questions | QuestionManage.vue | 题目管理 | 管理员 |
| /admin/questions/upload | QuestionUpload.vue | 题目导入 | 管理员 |
| /admin/traces | TraceManage.vue | 考试追踪 | 管理员 |

---

## 9. 状态管理

### 9.1 Auth Store

```javascript
{
  state: {
    loginFlag: boolean,
    userInfo: {
      id: number,
      userName: string,
      email: string,
      roleName: string,
      isActiveEmail: boolean
    }
  },
  
  getters: {
    isLoggedIn: boolean,
    isEmailVerified: boolean,
    userRole: string
  },
  
  actions: {
    login(loginForm),
    logout(),
    clearAuth(),
    updateUserInfo(userInfo),
    setEmailVerified(verified)
  }
}
```

### 9.2 Menu Store

```javascript
{
  state: {
    menuList: Array,
    loading: boolean,
    loaded: boolean
  },
  
  getters: {
    menus: Array,
    hasMenus: boolean
  },
  
  actions: {
    loadMenus(),
    clearMenus(),
    reloadMenus()
  }
}
```

### 9.3 Course Store

```javascript
{
  state: {
    courseList: Array,
    currentCourse: Object
  },
  
  actions: {
    setCourseList(list),
    setCurrentCourse(course)
  }
}
```

---

## 10. 权限控制

### 10.1 登录状态检查

所有需要登录的页面，通过路由守卫检查 `authStore.isLoggedIn`。

### 10.2 邮箱验证检查

大部分功能页面需要邮箱验证，通过路由守卫检查 `authStore.isEmailVerified`。

### 10.3 管理员权限检查

管理后台的路由通过动态路由实现权限控制：
1. 用户登录后，从后端获取菜单列表
2. 根据菜单列表动态添加路由
3. 访问不存在的路由时，自动跳转到首页

### 10.4 路由元信息

```javascript
meta: {
  title: '页面标题',
  requiresAuth: true,  // 需要登录
  requiresEmailVerified: true,  // 需要邮箱验证
  requiresAdmin: true,  // 需要管理员权限
  isDynamic: true  // 动态路由标记
}
```

---

## 11. 开发规范

### 11.1 命名规范

#### 文件命名
- 组件文件：PascalCase（如 `UserManage.vue`）
- 工具文件：camelCase（如 `excelParser.js`）
- 样式文件：kebab-case（如 `common.scss`）

#### 变量命名
- 常量：UPPER_SNAKE_CASE（如 `MAX_COUNT`）
- 变量/函数：camelCase（如 `userName`, `getUserInfo`）
- 组件名：PascalCase（如 `UserList`）

### 11.2 代码规范

#### Vue 组件结构
```vue
<template>
  <!-- HTML 模板 -->
</template>

<script setup>
// 1. 导入
import { ref, computed } from 'vue'

// 2. Props & Emits
const props = defineProps({})
const emit = defineEmits([])

// 3. 响应式数据
const data = ref(null)

// 4. 计算属性
const computed = computed(() => {})

// 5. 方法
const method = () => {}

// 6. 生命周期
onMounted(() => {})
</script>

<style scoped>
/* 样式 */
</style>
```

#### API 接口封装
```javascript
/**
 * 接口描述
 * @param {Object} params - 参数说明
 * @returns {Promise} 返回值说明
 */
export const apiName = (params) => {
  return request({
    url: '/api/path',
    method: 'GET',
    params
  })
}
```

### 11.3 注释规范

```javascript
/**
 * 函数描述
 * @param {Type} paramName - 参数说明
 * @returns {Type} 返回值说明
 */
function functionName(paramName) {
  // 实现逻辑
}
```

### 11.4 Git 提交规范

```
feat: 新功能
fix: 修复 bug
docs: 文档更新
style: 代码格式调整
refactor: 重构代码
perf: 性能优化
test: 测试相关
chore: 构建/工具链更新
```

---

## 12. 部署说明

### 12.1 环境变量配置

创建 `.env.production` 文件：
```bash
VITE_API_BASE_URL=https://api.pnrp.cn
```

### 12.2 构建

```bash
# 安装依赖
pnpm install

# 构建生产版本
pnpm build
```

构建产物在 `dist/` 目录。

### 12.3 部署到 Nginx

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    root /path/to/dist;
    index index.html;
    
    # SPA 路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API 代理（可选）
    location /api {
        proxy_pass https://api.pnrp.cn;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Gzip 压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

### 12.4 Docker 部署

创建 `Dockerfile`：
```dockerfile
FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm install -g pnpm && pnpm install
COPY . .
RUN pnpm build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

构建和运行：
```bash
docker build -t findrill-page .
docker run -d -p 80:80 findrill-page
```

### 12.5 性能优化建议

1. **代码分割**：使用动态导入 `import()`
2. **资源压缩**：启用 Gzip/Brotli
3. **CDN 加速**：将静态资源部署到 CDN
4. **缓存策略**：设置合理的 Cache-Control
5. **懒加载**：图片和组件懒加载
6. **Tree Shaking**：移除未使用的代码

---

## 附录

### A. 常见问题

#### Q1: 登录后提示邮箱未验证？
A: 需要先完成邮箱验证才能使用系统功能。在邮箱验证页面输入邮箱地址，点击发送验证链接，然后在邮件中点击链接完成验证。

#### Q2: 管理后台无法访问？
A: 需要管理员权限才能访问管理后台。请确保您的账号具有管理员角色。

#### Q3: 动态路由加载失败？
A: 检查菜单接口是否正常返回数据，确保组件路径正确。

#### Q4: 考试时间到了没有自动提交？
A: 检查浏览器控制台是否有错误，确保网络连接正常。

### B. 技术支持

- GitHub: https://github.com/HuangBranch/findrillPage
- API 文档: https://api.pnrp.cn/doc
- 问题反馈: [GitHub Issues](https://github.com/HuangBranch/findrillPage/issues)

---

**文档版本**: v1.0.0  
**最后更新**: 2025-12-24  
**作者**: HuangBranch
